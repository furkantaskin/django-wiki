"use strict";(self.webpackChunkdjango_wiki=self.webpackChunkdjango_wiki||[]).push([[7173],{3905:(e,i,n)=>{n.d(i,{Zo:()=>d,kt:()=>c});var t=n(7294);function a(e,i,n){return i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}function r(e,i){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);i&&(t=t.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?r(Object(n),!0).forEach((function(i){a(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}function o(e,i){if(null==e)return{};var n,t,a=function(e,i){if(null==e)return{};var n,t,a={},r=Object.keys(e);for(t=0;t<r.length;t++)n=r[t],i.indexOf(n)>=0||(a[n]=e[n]);return a}(e,i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)n=r[t],i.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=t.createContext({}),u=function(e){var i=t.useContext(s),n=i;return e&&(n="function"==typeof e?e(i):l(l({},i),e)),n},d=function(e){var i=u(e.components);return t.createElement(s.Provider,{value:i},e.children)},m={inlineCode:"code",wrapper:function(e){var i=e.children;return t.createElement(t.Fragment,{},i)}},p=t.forwardRef((function(e,i){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),p=u(n),c=a,k=p["".concat(s,".").concat(c)]||p[c]||m[c]||r;return n?t.createElement(k,l(l({ref:i},d),{},{components:n})):t.createElement(k,l({ref:i},d))}));function c(e,i){var n=arguments,a=i&&i.mdxType;if("string"==typeof e||a){var r=n.length,l=new Array(r);l[0]=p;var o={};for(var s in i)hasOwnProperty.call(i,s)&&(o[s]=i[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var u=2;u<r;u++)l[u]=n[u];return t.createElement.apply(null,l)}return t.createElement.apply(null,n)}p.displayName="MDXCreateElement"},9289:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var t=n(7462),a=(n(7294),n(3905));const r={sidebar_position:4,custom_edit_url:null,description:"Django ile form olu\u015fturma"},l="Form Olu\u015fturma",o={unversionedId:"django/orm/tutorial4",id:"django/orm/tutorial4",title:"Form Olu\u015fturma",description:"Django ile form olu\u015fturma",source:"@site/docs/django/orm/4-tutorial4.mdx",sourceDirName:"django/orm",slug:"/django/orm/tutorial4",permalink:"/django-wiki/docs/django/orm/tutorial4",draft:!1,editUrl:null,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,custom_edit_url:null,description:"Django ile form olu\u015fturma"},sidebar:"tutorialSidebar",previous:{title:"Django ile View Yap\u0131s\u0131",permalink:"/django-wiki/docs/django/orm/tutorial3"},next:{title:"Statik Dosyalar",permalink:"/django-wiki/docs/django/orm/tutorial5"}},s={},u=[{value:"\xd6rnek Form",id:"\xf6rnek-form",level:2},{value:"Generic Yap\u0131",id:"generic-yap\u0131",level:2}],d={toc:u};function m(e){let{components:i,...n}=e;return(0,a.kt)("wrapper",(0,t.Z)({},d,n,{components:i,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"form-olu\u015fturma"},"Form Olu\u015fturma"),(0,a.kt)("p",null,"Django i\xe7inde t\xfcm sorular\u0131m\u0131z g\xfczel bir \u015fekilde dinamik bir yap\u0131da listeledik. Peki bunlara nas\u0131l oy verece\u011fiz? Yani sistem neye oy verdi\u011fimizi ve bunlar\u0131 arka planada nas\u0131l tutacak? \u0130\u015fte bu b\xf6l\xfcmde bunu inceleyece\u011fiz."),(0,a.kt)("h2",{id:"\xf6rnek-form"},"\xd6rnek Form"),(0,a.kt)("p",null,"\xd6ncelikle detail.html i\xe7inde biz normalde soruya ait se\xe7eneklerimiz listeliyorduk ancak herhangi bir i\u015flem yapam\u0131yorduk. Art\u0131k bu k\u0131sm\u0131 biraz de\u011fi\u015ftirip g\xfczel bir form ekleyebiliriz. \xd6ncelikle detail.html dosyas\u0131n\u0131 elden ge\xe7iriyoruz."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-django",metastring:'title="apps/polls/templates/detail.html"',title:'"apps/polls/templates/detail.html"'},'<form action="{% url \'polls:vote\' question.id %}" method="post">\n{% csrf_token %}\n<fieldset>\n    <legend><h1>{{ question.question_text }}</h1></legend>\n    {% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}\n    {% for choice in question.choices.all %}\n        <input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}">\n        <label for="choice{{ forloop.counter }}">{{ choice.choice_text }}</label><br>\n    {% endfor %}\n</fieldset>\n<input type="submit" value="Vote">\n</form>\n')),(0,a.kt)("p",null,"Burada action veya method gibi attribute k\u0131s\u0131mlar\u0131n\u0131n ne i\u015fe yarad\u0131\u011f\u0131n\u0131 ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form"},"MDN \xfczerinden inceleyerek")," \xf6\u011frenebiliriz."),(0,a.kt)("admonition",{title:"\u0130pucu",type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Bu k\u0131s\u0131mdaki etiketler veya attributeler kafan\u0131z\u0131 kar\u0131\u015ft\u0131r\u0131yorsa frontend bilginizi g\xf6zden ge\xe7irmenizde fayda var. Bunun i\xe7in ",(0,a.kt)("a",{parentName:"p",href:"https://roadmap.sh"},"roadmap.sh")," adresini inceleyebilirsiniz ve backend k\u0131s\u0131mlar\u0131n\u0131 \xf6\u011frenebilirsiniz.")),(0,a.kt)("p",null,"Kodumuzu incelersek action k\u0131sm\u0131nda polls:vote ibaresi var. Bu demek oluyor ki urls i\xe7inde vote pathi bizi bir yerlere g\xf6t\xfcr\xfcyor. Normalde buradaki vote bizi views.py i\xe7indeki vote fonksiyonuna at\u0131yordu ve biz orada sadece bir metni yazd\u0131r\u0131yorduk. Ancak bunu bir miktar de\u011fi\u015ftirece\u011fiz. Buradaki csrf_token kavram\u0131 kafa kar\u0131\u015ft\u0131rabiliriz. Bunu ",(0,a.kt)("a",{parentName:"p",href:"https://docs.djangoproject.com/en/4.1/ref/csrf/"},"Django'nun sitesinden")," incelemekte fayda var."),(0,a.kt)("admonition",{title:"HATIRLATMA",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Burada ben models.py i\xe7inde Choice i\xe7in bir ",(0,a.kt)("a",{parentName:"p",href:"/django-wiki/docs/django/orm/tutorial3#template-ve-multiclass"},"related tan\u0131mlam\u0131\u015ft\u0131m"),". Bu related \xfczerinden de\u011fi\u015fiklik yaparak gidece\u011fim. E\u011fer siz yapmad\u0131ysan\u0131z kod i\xe7inde choices yazan yerleri choice_set olarak de\u011fi\u015ftirebilirsiniz.")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"forloop.counter")," nereden geldi diyebilirsiniz. Bunu asl\u0131nda bize Django veriyor. forloop.counter sayesinde 1 ile ba\u015flayan bir d\xf6ng\xfc indexi tan\u0131ml\u0131yoruz. Detayl\u0131 bilgi i\xe7in ",(0,a.kt)("a",{parentName:"p",href:"https://docs.djangoproject.com/en/4.1/ref/templates/builtins/#for"},"Django'nun sitesini")," ziyaret edebilirsiniz."),(0,a.kt)("p",null,"Ard\u0131ndan her bir input de\u011ferini se\xe7eneklerden al\u0131yoruz. Burada choice de\u011ferleri question'a ba\u011fl\u0131 oldu\u011fu i\xe7in ayr\u0131 bir tan\u0131mlamaya gerek yok. Related olarak hepsi gelecektir."),(0,a.kt)("p",null,'S\u0131rada formumuzun i\u015flemlerini d\xfczenlemede. \xd6n y\xfcz her ne kadar olsa da bunu arka tarafta veri taban\u0131na g\xf6ndermemiz ve modellerimiz g\xfcncellememiz gerekecek. Hat\u0131rlarsak views i\xe7in kullan\u0131c\u0131dan gelen iste\u011fe g\xf6re sayfada \xf6zelle\u015ftirmeler yapan bir yap\u0131 demi\u015ftik. \u0130\u015fte bunu bu k\u0131s\u0131mda daha iyi anlayaca\u011f\u0131z. \xd6ncelikle views.py i\xe7indeki vote fonksiyonumuzu "',(0,a.kt)("strong",{parentName:"p"},"birazc\u0131k"),'" de\u011fi\u015ftiriyoruz. '),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-py",metastring:'title="apps/polls/views.py"',title:'"apps/polls/views.py"'},"# highlight-start\nfrom django.http import HttpResponse, HttpResponseRedirect\nfrom django.shortcuts import render, get_object_or_404\nfrom django.urls import reverse\nfrom .models import Question, Choice\n# highlight-end\n\ndef index(request):\n    latest_question_list = Question.objects.order_by('-pub_date')\n    context = {'latest_question_list': latest_question_list}\n    return render(request, 'index.html', context)\n\n\ndef detail(request, quest_id):\n    question = get_object_or_404(Question, pk=quest_id)\n    return render(request, 'detail.html', {'question': question})\n\n\ndef result(request, quest_id):\n    return HttpResponse(\"You're looking at the results of %s question\" % quest_id)\n\n# highlight-start\ndef vote(request, quest_id):\n    question = get_object_or_404(Question, pk=quest_id)\n    try:\n        selected_choice = question.choices.get(pk=request.POST['choice'])\n    except (KeyError, Choice.DoesNotExist):\n        # Redisplay the question voting form.\n        return render(request, 'detail.html', {\n            'question': question,\n            'error_message': \"You didn't select a choice.\",\n        })\n    else:\n        selected_choice.votes += 1\n        selected_choice.save()\n        # Always return an HttpResponseRedirect after successfully dealing\n        # with POST data. This prevents data from being posted twice if a\n        # user hits the Back button.\n        return HttpResponseRedirect(reverse('polls:result', args=(question.id,)))\n# highlight-end\n")),(0,a.kt)("p",null,"Kodumu uzun gelse de asl\u0131nda \xe7ok bir i\u015flem yok. \xd6ncelikle baz\u0131 k\xfct\xfcphaneler ekledik, bunlar\u0131 zaten i\xe7eride kulland\u0131k\xe7a anlataca\u011f\u0131z. Sonras\u0131nda bizim se\xe7ilen cevab\u0131m\u0131z\u0131n nereden gelece\u011fini g\xf6stermek i\xe7in o cevab\u0131n tan\u0131ml\u0131 oldu\u011fu sorudaki cevaplara bak\u0131yoruz. Ve diyoruz ki kullan\u0131c\u0131n\u0131n post etti\u011fi veri bizim sorumuzda bulunan cevaplar i\xe7inden geliyor. E\u011fer burada bir hatam\u0131z varsa (\xf6rne\u011fin cevap se\xe7meden g\xf6nder demek gibi) o zaman kullan\u0131c\u0131m\u0131za bir hata var burada, sen bir se\xe7im yapmad\u0131n diyoruz. question tan\u0131mlamas\u0131n\u0131 zaten detail i\xe7inde de yapt\u0131\u011f\u0131m\u0131z i\xe7in template i\xe7inde kullanaca\u011f\u0131m\u0131z biliyoruz. Burada g\xf6rd\xfc\u011f\xfcm\xfc iki farkl\u0131 sat\u0131r var. Birincisi ",(0,a.kt)("inlineCode",{parentName:"p"},"selected_choice.save()")," ve ikincisi ",(0,a.kt)("inlineCode",{parentName:"p"},"return HttpResponseRedirect(reverse('polls:results', args=question.id))")," sat\u0131r\u0131. Burada .save() k\u0131sm\u0131 veriyi veri taban\u0131na kaydederken return k\u0131sm\u0131 ise kulan\u0131c\u0131nn birden fazla oy kullanmas\u0131n\u0131 \xf6nlemek i\xe7in bizi belirledi\u011fimiz bir sayfaya y\xf6nlendiriyor. Biz burada gidilecek sayfa olarak results sayfas\u0131n\u0131 se\xe7tik. Results sayfas\u0131n\u0131 ise views i\xe7indeki result fonksiyonuyla kontrol ediyorduk. Art\u0131k kullan\u0131c\u0131m\u0131z oy kulland\u0131\u011f\u0131 i\xe7in onu sonu\xe7lar sayfas\u0131na iletebiliriz. Bunun i\xe7in result fonksiyonunu da biraz de\u011fi\u015ftirece\u011fiz. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-py"},"def result(request, quest_id):\n    question = get_object_or_404(Question, pk=quest_id)\n    return render(request, 'results.html', {'question': question})\n")),(0,a.kt)("p",null,"Ard\u0131ndan templates klas\xf6r\xfcm\xfcze bir de results.html dosyas\u0131 olu\u015fturaca\u011f\u0131z. Burada sorumuzun alt\u0131na cevaplar\u0131m\u0131z\u0131 g\xf6sterip hangisinin ka\xe7 oy ald\u0131\u011f\u0131n\u0131 g\xf6stermemiz laz\u0131m. Bunun i\xe7in html dosyas\u0131na bir ekleme yap\u0131yoruz."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-django",metastring:'title="apps/polls/templates/results.html"',title:'"apps/polls/templates/results.html"'},"<h1>{{ question.question_text }}</h1>\n\n<ul>\n{% for choice in question.choices.all %}\n    <li>{{ choice.choice_text }} -- {{ choice.votes }} vote{{ choice.votes|pluralize }}</li>\n{% endfor %}\n</ul>\n\n<a href=\"{% url 'polls:detail' question.id %}\">Vote again?</a>\n")),(0,a.kt)("p",null,"Buradaki pluralize olay\u0131n\u0131n ne oldu\u011funu sorabilirsiniz. Buradaki ama\xe7 de\u011ferin 1'den b\xfcy\xfck olmas\u0131 durumunda (vote bu durumda votes olacakt\u0131r) ne yapmam\u0131z gerekti\u011fini belirtir. Django normalde pluralize durumunda metnin sonuna s tak\u0131s\u0131 atar ancak siz bunu \xf6zelle\u015ftirebilirsiniz. Detayl\u0131 bilgi i\xe7in ",(0,a.kt)("a",{parentName:"p",href:"https://docs.djangoproject.com/en/4.1/ref/templates/builtins/#pluralize"},"Django'nun sitesini ziyaret edebilirsiniz.")),(0,a.kt)("p",null,"Burada asl\u0131nda \xe7ok bir \u015fey anlatmaya grek yok. Yap\u0131lan i\u015flemler kodu okuyunca anla\u015f\u0131labiliyor.Art\u0131k sorudaki her bir se\xe7ene\u011fi i\u015faretledik\xe7e modelimiz buna g\xf6re g\xfcncellemeler yapacak ve bu da views i\xe7inde gerekli g\xfcncellemeleri yapacakt\u0131r."),(0,a.kt)("admonition",{title:"K\u0130\u015e\u0130SEL NOT",type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Burada ilgimi \xe7eken tek k\u0131s\u0131m \u015fu oldu: E\u011fer y\xf6netim paneline ba\u015fka bir soru i\xe7in bir daha Feels great se\xe7ene\u011fi ekledi\u011fimizde listelemede iki tane Feels great g\xf6r\xfcn\xfcyor. Bu biraz kafa kar\u0131\u015ft\u0131rabilir mi diye d\xfc\u015f\xfcnmedim de\u011fil")),(0,a.kt)("h2",{id:"generic-yap\u0131"},"Generic Yap\u0131"),(0,a.kt)("p",null,'\u0130\u015fin asl\u0131nda bir t\u0131k kar\u0131\u015f\u0131k k\u0131sm\u0131na geliyoruz. Normalde views i\xe7inde her \u015feyi birer fonksiyon ile halledip sonucu render ediyorduk. Ancaj Django, felsefesi i\xe7erisinde KISS (Keep it simple stupid) mant\u0131\u011f\u0131 g\xfctmekte. Bunu daha medeni s\xf6yleyecek olursak "less code is better" diyebiliriz. Peki bu nas\u0131l olacak? Yani elimizdeki kod zaten k\u0131sa de\u011fil mi? Her fonksiyon en fazla iki sat\u0131r al\u0131yor. Evet k\u0131sa ancak i\u015flevsellik de \xf6nemli. Bunu da Django "generic" dedi\u011fimiz yap\u0131 ile sa\u011fl\u0131yor. Asl\u0131nda kodumuz k\u0131sa olsa da urls.py i\xe7inde kontrol yeri gelince zorla\u015fabilir. Bunun \xf6n\xfcne ge\xe7ebiliriz. Peki nas\u0131l? '),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-py",metastring:'title="apps/polls/urls.py"',title:'"apps/polls/urls.py"'},"from django.urls import path\nfrom . import views\n\napp_name = 'polls'\n# highlight-start\nurlpatterns = [\n    path('', views.IndexView.as_view(), name='index'),\n    path('<int:pk>/', views.DetailView.as_view(), name='detail'),\n    path('<int:pk>/results/', views.ResultsView.as_view(), name='result'),\n    path('<int:quest_id>/vote/', views.vote, name='vote'),\n]\n# highlight-end\n")),(0,a.kt)("p",null,"Fark\u0131ndaysaan\u0131z geni birka\xe7 yap\u0131 geldi. Art\u0131k quest_id \u015feklinde url i\xe7inde sorgulama yapm\u0131yoruz. Tek yap\u0131t\u011f\u0131m\u0131z sorunun kendi id'sini g\xf6ndermek (buradaki pk Primary Key anlam\u0131na geliyor. Bu da bizim id de\u011ferimize e\u015fit). S\u0131rada views.py i\xe7inde g\xfcncelleme yapma vakti."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-py",metastring:'title="apps/polls/views.py"',title:'"apps/polls/views.py"'},"from django.http import HttpResponseRedirect\nfrom django.shortcuts import get_object_or_404, render\nfrom django.urls import reverse\n# highlight-start\nfrom django.views import generic\n\nfrom .models import Choice, Question\n\n\nclass IndexView(generic.ListView):\n    template_name = 'polls/index.html'\n    context_object_name = 'latest_question_list'\n\n    def get_queryset(self):\n        \"\"\"Return the last five published questions.\"\"\"\n        return Question.objects.order_by('-pub_date')[:5]\n\n\nclass DetailView(generic.DetailView):\n    model = Question\n    template_name = 'polls/detail.html'\n\n\nclass ResultsView(generic.DetailView):\n    model = Question\n    template_name = 'polls/results.html'\n# highlight-end\n\ndef vote(request, quest_id):\n    question = get_object_or_404(Question, pk=quest_id)\n    try:\n        selected_choice = question.choices.get(pk=request.POST['choice'])\n    except (KeyError, Choice.DoesNotExist):\n        # Redisplay the question voting form.\n        return render(request, 'detail.html', {\n            'question': question,\n            'error_message': \"You didn't select a choice.\",\n        })\n    else:\n        selected_choice.votes += 1\n        selected_choice.save()\n        # Always return an HttpResponseRedirect after successfully dealing\n        # with POST data. This prevents data from being posted twice if a\n        # user hits the Back button.\n        return HttpResponseRedirect(reverse('polls:result', args=(question.id,)))\n\n")),(0,a.kt)("p",null,"Peki as\u0131l e\u011flence views i\xe7inde d\xf6n\xfcyor. Neler oldu burada b\xf6yle? "),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\xd6ncelikle bir generic view yap\u0131s\u0131n\u0131 class ile olu\u015fturduk. Fark\u0131ndaysan\u0131z \xfc\xe7 s\u0131n\u0131f i\xe7in iki farkl\u0131 genericview var elimizde. Birisi DetailView, di\u011feri ise ListView. Bunlar ne i\u015fe yar\u0131yor peki?",(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"Buradaki DetailView: Tekil bir nesne g\xf6stermek i\xe7in kullan\u0131l\u0131yor"),(0,a.kt)("li",{parentName:"ol"},"Buradaki ListView: Nesnelerden olu\u015fan bir listeyi g\xf6r\xfcnt\xfclemek i\xe7in ideal. (Kendime not: generic view k\u0131sm\u0131n\u0131 iyi anla)"))),(0,a.kt)("li",{parentName:"ol"},"Sonras\u0131nda her view i\xe7in hangi modeli baz ald\u0131ysak ve bu modeli hangi template i\xe7inde g\xf6steriyorsak bunlar\u0131 ",(0,a.kt)("inlineCode",{parentName:"li"},"model")," ve ",(0,a.kt)("inlineCode",{parentName:"li"},"template_name")," i\xe7inde belirttik. render, return ve di\u011fer k\u0131s\u0131mlar\u0131 fark\u0131ndaysan\u0131z Django kendisi halletti."),(0,a.kt)("li",{parentName:"ol"},"ListView i\xe7in elimzdeki nesne listesinin gelece\u011fi listeye bir ad verdik. Bunu ",(0,a.kt)("inlineCode",{parentName:"li"},"context_object_name")," ile yapt\u0131k. \xd6nceden render i\xe7inde \xfc\xe7\xfcnc\xfc parametrede ",(0,a.kt)("inlineCode",{parentName:"li"},"{'latest_question_list': latest_question_list}")," olarak yapt\u0131\u011f\u0131m\u0131z \u015feyi art\u0131k context_object_name olarak g\xf6nderdik."),(0,a.kt)("li",{parentName:"ol"},"Django'nun geri kalan her \u015feyi ayarlamas\u0131n\u0131n keyfini \xe7\u0131kard\u0131k.")))}m.isMDXComponent=!0}}]);